@using EECIP.App_Logic.DataAccessLayer
@model EECIP.Models.vmDashboardIndex
@{
    ViewBag.Title = "Welcome " + Model.UserName + "!";
}

<!--  ************ BADGES *********-->
<section class="panel panel-default ">
    <div class="panel-heading">
        Badge Progress
        <div class="panel-tools">
            <a class="btn btn-xs panel-collapse collapses" href="#">
            </a>
        </div>
    </div>
    <div class="panel-body">
        <div class="row">
            <div class="col-md-12">
                <div class="badgeholder">
                    <div class="publicbadgeline" style="width:100%">
                        @for (int i = 0; i < 6; i++)
                        {
                            <div class="publicbadge col-md-2 col-sm-4 tooltips col-xs-6" data-original-title="@Model.UserBadges[i]._Badge.Description">
                                <img src="/Content/Images/badges/@(Model.UserBadges[i]._Badge.Image)" alt="@Model.UserBadges[i]._Badge.DisplayName" class="@(Model.UserBadges[i].UserEarnedInd ? "fff" : "grey")">
                                <p class="publicbadgenamedesc">@Model.UserBadges[i]._Badge.DisplayName</p>
                                @if (Model.UserBadges[i].EarnedDate.HasValue)
                                {
                                    <p class="publicbadgeawards" style="color:green"><b>Awarded @(Model.UserBadges[i].EarnedDate.HasValue ? Model.UserBadges[i].EarnedDate.Value.ToShortDateString() : "")</b></p>
                                }
                                else
                                {
                                    <p class="publicbadgeawards">Not Awarded</p>
                                }
                            </div>
                        }
                    </div>


                    <div id="collapseThree" class="publicbadgeline panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree" style="width:100%">
                        @for (int i = 6; i < Model.UserBadges.Count; i++)
                        {
                            <div class="publicbadge col-md-2 col-sm-4 tooltips col-xs-6" data-original-title="@Model.UserBadges[i]._Badge.Description">
                                <img src="/Content/Images/badges/@(Model.UserBadges[i]._Badge.Image)" alt="@Model.UserBadges[i]._Badge.DisplayName" class="@(Model.UserBadges[i].UserEarnedInd ? "fff" : "grey")">
                                <p class="publicbadgenamedesc">@Model.UserBadges[i]._Badge.DisplayName</p>
                                @if (Model.UserBadges[i].EarnedDate.HasValue)
                                {

                                    <p class="publicbadgeawards" style="color:green">Awarded @(Model.UserBadges[i].EarnedDate.HasValue ? Model.UserBadges[i].EarnedDate.Value.ToShortDateString() : "")</p>
                                }
                                else
                                {
                                    <p class="publicbadgeawards">Not Awarded</p>
                                }
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a id="badgefooter" class="collapsed panel-footer" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree" style="width: 100%;display: block;text-align: center; text-decoration: none;">
        Show All <i class="glyphicon clip-arrow-down"></i>
    </a>
</section>

<!--  ************  PROJECTS NEEDING REVIEW *************-->
@if (Model.ProjectsNeedingReview != null && Model.ProjectsNeedingReview.Count > 0)
{
<section class="panel panel-default danger">
    <div class="panel-heading">
        Projects Needing Your Review
        <div class="panel-tools">
            <a class="btn btn-xs panel-collapse collapses" href="#">
            </a>
        </div>
    </div>
    <div class="panel-body" id="collapseProj">

        <div class="table-responsive"  style="max-height:200px;">
            <table class="table table-hover table-striped m-b-none table-bordered" data-ride="datatables" >
                <thead class="thead-inverse">
                    <tr>
                        <th></th>
                        <th>Reason for Review</th>
                        <th>Project Name</th>
                        <th>Description</th>
                        <th>Record Source</th>
                    </tr>
                </thead>
                <tbody>


                @foreach (var item in Model.ProjectsNeedingReview)
                {
                    <tr>
                        <td>
                            <a href="@Url.Action("ProjectDetails", "Dashboard", new { id = item.PROJECT_IDX })" class="btn btn-rounded btn-xs btn-info"><i class="glyphicon glyphicon-pencil"></i> Review</a>
                        </td>
                        <td style="color:#dc3545; font-weight:bold">
                            @if (item.PROJECT_CONTACT_IDX == null)
                            {
                            <text>Project is unclaimed</text>
                            }
                            else
                            {
                                <text>Project hasn't been updated in 6 months</text>
                            }
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.PROJ_NAME)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.PROJ_DESC)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.RECORD_SOURCE)
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        </div>

    </div>
</section>
}

@section Scripts {
    <script type="text/javascript">
        $('#badgefooter').click(function () {
            $(this).html(function (i, old) {
                return old == 'Show Less <i class="glyphicon clip-arrow-up"></i>' ? 'Show All <i class="glyphicon clip-arrow-down"></i>' : 'Show Less <i class="glyphicon clip-arrow-up"></i>';
            });
        });
    </script>
}